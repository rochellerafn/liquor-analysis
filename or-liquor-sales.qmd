---
title: "OR-liquor-analysis"
author: "Rochelle Rafn"
format: html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(dplyr)
library(ggplot2)
library(lubridate)
```


```{r}
or_sales <- read.csv('/Users/rochellerafn/RStudio_Files/liquor-analysis/OR-Liquor-Sales-Store.csv')
```

```{r}
str(or_sales)
```

```{r}
or_sales <- or_sales %>%
  mutate(Month = month.name[Month], Year = as.character(Year))

or_sales$Month = factor(or_sales$Month, levels = month.name)

head(or_sales)
```


```{r}
unique(or_sales$COUNTY)
```

```{r}
unique(or_sales$Year)
```

```{r}
or_sales %>%
 group_by(Store..) %>%
  summarise()
```

```{r}
or_sales_yearly <- or_sales %>%
  group_by(Year, Month) %>%
  summarize(sum(Total.Sales))

or_sales_yearly <- or_sales_yearly %>%
  rename("Total.Sales" = "sum(Total.Sales)")

head(or_sales_yearly)
```

```{r}
# write.csv(or_sales_yearly, '/Users/rochellerafn/RStudio_Files/liquor-analysis/or_sales_yearly.csv')
```



```{r}
# library(MetBrewer)
# install.packages("devtools")
# devtools::install_github("BlakeRMills/MetBrewer")

or_sales_yearly %>%
  filter(Year < 2023) %>%
ggplot(aes(Month, Total.Sales, group = Year, color = Year)) +
  geom_line(stat = "identity")+
  scale_y_continuous(labels = scales::comma)+
  theme(panel.background = element_blank(),
        plot.background = element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  scale_color_met_d("Klimt")+
  labs(title = "Seasonality of Oregonian's Liquor Consumption is Consistent",
       subtitle = "Total Liquor Sales in Oregon",
       y = "Total Sales (in dollars)")
```

```{r}
or_sales_yearly %>%
  filter(Year < 20213) %>%
ggplot(aes(Year, Total.Sales, fill = Year, color = Year))+
  geom_col(stat = "identity")+
  scale_y_continuous(labels = scales::comma)+
  theme(panel.background = element_blank(),
        plot.background = element_blank())+
  scale_fill_met_d("Klimt")+
  scale_color_met_d("Klimt")+
  labs(y = "Total Sales (in dollars)")
```


```{r}
or_store_sales <- or_sales %>%
  group_by(Year, Month, BusinessName) %>%
  summarize(sum(Total.Sales))

or_store_sales <- or_store_sales %>%
  rename("Total.Sales" = "sum(Total.Sales)") %>%
  arrange(desc(Total.Sales))

head(or_store_sales)
```

```{r}
or_county_sales <- or_sales %>%
  group_by(Year, Month, COUNTY) %>%
  filter(Year < 2023) %>%
  summarize(sum(Total.Sales))

or_county_sales <- or_county_sales %>%
  rename("Total.Sales" = "sum(Total.Sales)") %>%
  arrange(desc(Total.Sales))

head(or_county_sales)
```


```{r}
or_county_sales %>%
ggplot(aes(reorder(COUNTY, -Total.Sales), Total.Sales, fill = COUNTY)) +
  geom_col()+
  scale_y_continuous()+
  theme_void()+
  facet_wrap(~Year)
```

